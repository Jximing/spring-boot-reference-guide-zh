# 13. Build Systems

强烈建议你选择一个支持[依赖管理](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/reference/htmlsingle/#using-boot-dependency-management)和消费发布到 "Maven Central" 的 artifacts 的构建工具。我们推荐你使用 Maven 或者 Gradle 。Spring Boot 也可以和其它构建系统一起使用（例如： Ant ），但是可能不能很好的支持。

<br>

## 13.1 Dependency Management

每个版本的 Spring Boot 都提供了他支持的依赖的列表。实际上，在你的构建配置中，你不需要说明这些依赖的版本， Spring Boot 帮你管理了这些。当你更新 Spring Boot 的时候，这些依赖都会一起更新。
>:note: 当你需要的时候，你依然可以指定一个版本来覆盖 Spring Boot 的推荐配置。

依赖列表包含了能和 Spring Boot 一起使用的所有 Spring 模块以及精确的第三方库。该列表适用于 [`spring-boot-dependencies` 提供的标准清单](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/reference/htmlsingle/#using-boot-maven-without-a-parent) 能使用 [Macen](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/reference/htmlsingle/#using-boot-maven-parent-pom) 和 [Gradle](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/reference/htmlsingle/#using-boot-gradle) 获取。
>:warning:每个版本的 Spring Boot 都和特定版本的 Spring 框架版本关联，我们强烈建议你不要指定它的版本。

<br>

## 13.2 Maven

Maven 用户可以继承 `spring-boot-starter-parent` 项目以获得合理的配置。这个父项目提供下面的特性：
- 默认编辑器为 Java 8 。
- 文件编码为 UTF-8 
- 继承自 `spring-boot-dependencies pom` 的[依赖管理节点](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/reference/htmlsingle/#using-boot-dependency-management),能让你在你自己的 pom 文件里面忽略 `<version>` 标签。
- 合理的[文件过滤](https://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html)
- 恰到好处的插件配置 (exec plugin, Git commit ID, and shade) 。
- 恰到好处的对 `application.properties` 和 `application.yml` 文件的过滤包括具体的配置文件（例如： `application-dev.properties` 和 `application-dev.yml` ）。

需要注意的是， `application.properties` 和 `application.yml` 使用了 Spring 的占位符 `${...}` Maven filtering 改成使用 `@...@` 占位符（你可以设置 `resource.delimiter` 来重写这个配置）。

### 13.2.1 Inheriting the Starter Parent

为了让你的项目从 `spring-boot-starter-parent` 出继承配置，需要像下面一样设置 `parent` 节点：
```xml
<!-- Inherit defaults from Spring Boot -->
<parent>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-parent</artifactId>
	<version>2.0.2.RELEASE</version>
</parent>
```
>:note:你只需要知道 Spring Boot 的版本，如果你加了额外的 starter ，你能很安全的忽略依赖的版本。

这样建立后，你仍然可以通过重写属性来配置你自己的依赖。例如，为了使用其它版本的 Spring Data 你可以在你的 `pom.xml` 中加入：
```xml
<properties>
	<spring-data-releasetrain.version>Fowler-SR2</spring-data-releasetrain.version>
</properties>
```
>:star:详见 [`spring-boot-dependencies` pom](https://github.com/spring-projects/spring-boot/tree/v2.0.2.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml) 获取支持的属性。

### 13.2.2 Using Spring Boot without the Parent POM

不是所有人都喜欢从 `spring-boot-starter-parent` 继承 POM 。可能你需要使用你们公司自己的标准父项目或者你更喜欢明确的说明你所有的 Maven 配置。

如果你不想使用 `spring-boot-starter-parent` ，你任然可以从依赖管理中受益（但不是插件管理）使用 `scope=import` ，像下面一样：
```xml
<dependencyManagement>
		<dependencies>
		<dependency>
			<!-- Import dependency management from Spring Boot -->
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-dependencies</artifactId>
			<version>2.0.2.RELEASE</version>
			<type>pom</type>
			<scope>import</scope>
		</dependency>
	</dependencies>
</dependencyManagement>
```
如上所述，前面的示例设置不允许您使用属性覆盖单个依赖项。为了达到同样的效果你需要在  `dependencyManagement` 节点中的 `spring-boot-dependencies` 之前加入。例如，为了升级 Spring Data 版本，你可以在你的 `pom.xml` 文件中加入下面的元素：
```xml
<dependencyManagement>
	<dependencies>
		<!-- Override Spring Data release train provided by Spring Boot -->
		<dependency>
			<groupId>org.springframework.data</groupId>
			<artifactId>spring-data-releasetrain</artifactId>
			<version>Fowler-SR2</version>
			<type>pom</type>
			<scope>import</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-dependencies</artifactId>
			<version>2.0.2.RELEASE</version>
			<type>pom</type>
			<scope>import</scope>
		</dependency>
	</dependencies>
</dependencyManagement>
```
>:star:在前面的示例中我们指定了 BOM ，任何类型的依赖都可以通过同样的方式进行覆盖。

### 13.2.3 Using the Spring Boot Maven Plugin

Spring Boot 包含了能将项目打成可执行 jar 包的 [Maven Plugin](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/reference/htmlsingle/#build-tool-plugins-maven-plugin) 。如果你想使用的话像下面一样将它加入你的 `plugins` 节点：
```xml
<build>
	<plugins>
		<plugin>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-maven-plugin</artifactId>
		</plugin>
	</plugins>
</build>
```
>:star:如果你使用 Spring Boot starter parent pom ，你只需要将它加进来。除非你想改变默认配置才需要配置它。

<br>

## 13.3 Gradle

为了了解 Spring Boot 如何与 Gradle 一起使用，请参考 Spring Boot 的 Gradle plugin 文档：
- 参考 （ [HTML](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/gradle-plugin/reference/html) 和 [PDF](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/gradle-plugin/reference/pdf/spring-boot-gradle-plugin-reference.pdf) ）
- [API](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/gradle-plugin/api)
  
<br>

## 13.4 Ant

使用 Apache Ant+Ivy 构建 Spring Boot 项目是完全有可能的。 `spring-boot-antlib` 的 “AntLib” 模块适用与 Ant 创建可执行 jars 。为了声明依赖，使用下面示例的典型的 `ivy.xml` ：
```xml
<ivy-module version="2.0">
	<info organisation="org.springframework.boot" module="spring-boot-sample-ant" />
	<configurations>
		<conf name="compile" description="everything needed to compile this module" />
		<conf name="runtime" extends="compile" description="everything needed to run this module" />
	</configurations>
	<dependencies>
		<dependency org="org.springframework.boot" name="spring-boot-starter"
			rev="${spring-boot.version}" conf="compile" />
	</dependencies>
</ivy-module>
```
典型的 `build.xml` ：
```xml
<project
	xmlns:ivy="antlib:org.apache.ivy.ant"
	xmlns:spring-boot="antlib:org.springframework.boot.ant"
	name="myapp" default="build">

	<property name="spring-boot.version" value="2.0.2.RELEASE" />

	<target name="resolve" description="--> retrieve dependencies with ivy">
		<ivy:retrieve pattern="lib/[conf]/[artifact]-[type]-[revision].[ext]" />
	</target>

	<target name="classpaths" depends="resolve">
		<path id="compile.classpath">
			<fileset dir="lib/compile" includes="*.jar" />
		</path>
	</target>

	<target name="init" depends="classpaths">
		<mkdir dir="build/classes" />
	</target>

	<target name="compile" depends="init" description="compile">
		<javac srcdir="src/main/java" destdir="build/classes" classpathref="compile.classpath" />
	</target>

	<target name="build" depends="compile">
		<spring-boot:exejar destfile="build/myapp.jar" classes="build/classes">
			<spring-boot:lib>
				<fileset dir="lib/runtime" />
			</spring-boot:lib>
		</spring-boot:exejar>
	</target>
</project>
```
>:star:如果你不想使用 `spring-boot-antlib` 模块，查看 [Section 86.9, “Build an Executable Archive from Ant without Using spring-boot-antlib](https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/reference/htmlsingle/#howto-build-an-executable-archive-with-ant)

<br>

## 13.5 Starters

